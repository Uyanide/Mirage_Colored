<!doctype html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>幻影坦克生成</title></head><body class="displayFlexColumn marginTopHigh backgroundPrimary frontColor"><h1 class="title marginBottomMedium">幻影坦克工厂</h1><div class="fontMedium frontSecondaryColor marginTopMedium">支持全彩喔 ;D</div><div class="switchContainer displayFlexRow paddingHigh backgroundSecondary" id="isDarkmodeContainer"><div id="isDarkModeLabel" class="marginRightLow fontMedium">关灯</div><label class="switch"><input type="checkbox" id="isDarkmodeCheckbox"> <span class="switchSlider"></span></label></div><div class="DisplayArea displayFlexColumn refWidthFull marginTopHigh"><div class="PageContainer borderRadiusExtreme fontMedium frontColor displayFlexColumn refWidthHigh backgroundSecondary paddingHigh"><div class="RowContainer refWidthHigh displayFlexRow justifySpaceBetween marginTopHigh"><div class="CanvasContainer displayFlexColumn paddingMedium refWidthHalf"><div class="marginBottomMedium"><label for="innerFileInput" class="inputReact transformSize">选择里图文件</label> <input type="file" id="innerFileInput" accept="image/*"></div><div id="innerInputHint" class="displayFlexColumn marginTopLow fontSmall"><div>或拖动至下方画布</div><div class="marginTopLow">或粘贴 (ctrl+v)</div></div><canvas id="innerCanvas" class="refWidthFull marginTopMedium"></canvas></div><div class="CanvasContainer displayFlexColumn paddingMedium refWidthHalf"><div class="marginBottomMedium"><label for="coverFileInput" class="inputReact transformSize">选择表图文件</label> <input type="file" id="coverFileInput" accept="image/*"></div><div id="coverInputHint" class="displayFlexColumn marginTopLow fontSmall"><div>或拖动至下方画布</div><div class="marginTopLow">或粘贴 (ctrl+v)</div></div><canvas id="coverCanvas" class="refWidthFull marginTopMedium"></canvas></div></div><div class="RowContainer refWidthHigh displayFlexRow justifySpaceBetween marginTopHigh"><div class="CanvasContainer displayFlexColumn paddingMedium refWidthHalf"><div class="switchContainer"><div class="marginRightLow fontMedium">全彩输出</div><label class="switch"><input type="checkbox" id="isColoredCheckbox"> <span class="switchSlider"></span></label></div><hr class="refWidthHigh marginTopMedium marginBottomMedium"><button id="swapButton" class="inputReact transformSize">表里图互换</button><hr class="refWidthHigh marginTopMedium marginBottomMedium"><div class="">输出图像尺寸:</div><input type="number" id="maxSizeInput" class="inputReact marginTopLow" min="1" max="4096"><div class="marginTopLow fontSmall frontSecondaryColor">(指长和宽中的较大值)</div><div class="fontSmall frontSecondaryColor">(0即为不指定)</div><hr class="refWidthHigh marginTopMedium marginBottomMedium"><div class="">里图混合权重</div><input type="range" id="innerWeightRange" class="refWidthHigh marginTopLow" min="0" max="1" step="0.02"><div class="marginTopLow"><span>或输入: </span><input type="number" id="innerWeightInput" class="inputReact" step="0.02"></div><div class="marginTopLow fontSmall frontSecondaryColor">(0~1,黑白输出时无效)<br>(越高里图色彩越准确)<br>(反之表图色彩越准确)</div></div><div class="CanvasContainer displayFlexColumn paddingMedium refWidthHalf"><div class="">↓ 输出图像 ↓</div><canvas id="outputCanvas" class="refWidthFull marginTopMedium"></canvas><button id="saveButton" class="inputReact transformSize marginTopHigh">保存结果</button></div></div><div class="RowContainer refWidthHigh displayFlexRow justifySpaceBetween marginTopHigh marginBottomHigh"><div class="CanvasContainer displayFlexColumn paddingMedium refWidthHalf"><div class="marginTopMedium">里图色阶缩放</div><input type="range" id="innerScaleRange" class="refWidthHigh marginTopLow" min="0" max="1" step="0.02"><div class="marginTopLow"><span>或输入: </span><input type="number" id="innerScaleInput" class="inputReact" step="0.02"></div><div class="marginTopLow diplayFlexColumn fontSmall frontSecondaryColor">(0~1,越低里图越暗)</div><div class="marginTopMedium">↓ 黑色背景预览 ↓</div><canvas id="blackCanvas" class="refWidthFull marginTopMedium"></canvas></div><div class="CanvasContainer displayFlexColumn paddingMedium refWidthHalf"><div class="marginTopMedium">表图色阶缩放</div><input type="range" id="coverScaleRange" class="refWidthHigh marginTopLow" min="0" max="1" step="0.02"><div class="marginTopLow"><span>或输入: </span><input type="number" id="coverScaleInput" class="inputReact" step="0.02"></div><div class="marginTopLow diplayFlexColumn fontSmall frontSecondaryColor">(0~1,越高表图越亮)</div><div class="marginTopMedium">↓ 白色背景预览 ↓</div><canvas id="whiteCanvas" class="refWidthFull marginTopMedium"></canvas></div></div></div></div><div id="pageBelow" class="displayFlex frontColor justifyCenter alignCenter flexColumn marginTopHigh"><div id="versionInfo" class="fontLarge">version: <b>UNKNOWN</b></div><div class="marginTopLow fontSmall">如发现有功能不正常可手动清理浏览器缓存后刷新</div><div class="marginTopMedium fontSmall transformSize"><a class="frontLinkColor" href="https://github.com/Uyanide" target="_blank">Github - Uyanide (我)</a></div><div class="marginTopMedium fontSmall transformSize"><a class="frontLinkColor" href="https://github.com/Uyanide/Mirage_Colored" target="_blank">Github - Mirage_Cloak (本项目仓库)</a></div><div id="toggleVersionRecord" class="frontLinkColor backgroundPrimary fontSmall transformSize marginTopMedium">显示主要更新记录</div><div id="versionRecord" class="marginTopMedium marginBottomMedium"><table id="versionRecordTable" class="fontSmall paddingHigh borderRadiusExtreme displayNone backgroundSecondary borderCollapse"><tbody><tr><td>1.0.0</td><td>初始版本。</td></tr></tbody></table></div></div><script defer="defer">/*! For license information please see main.8e510cee7a459bf2f3d9.js.LICENSE.txt */
(()=>{"use strict";var e={431:(e,t,n)=>{n.d(t,{A:()=>c});var r=n(601),a=n.n(r),o=n(314),i=n.n(o)()(a());i.push([e.id,':root {\n    --secondary-background-color: #fff;\n    --background-color: #ececec;\n    --secondary-notselected-background-color: #f6f6f6;\n    --element-backgound-color: #f6f6f6;\n    --front-color: #000;\n    --front-secondary-color: #666;\n    --element-border-color: #b8b8b8;\n    --link-color: #2285d5;\n\n    --large-font-size: 1.2rem;\n    --medium-font-size: 0.9rem;\n    --small-font-size: 0.7rem;\n}\n\n[data-theme="light"] {\n    --secondary-background-color: #fff;\n    --background-color: #ececec;\n    --secondary-notselected-background-color: #f6f6f6;\n    --element-backgound-color: #eaeaea;\n    --front-color: #000;\n    --front-secondary-color: #666;\n    --element-border-color: #b8b8b8;\n    --link-color: #2285d5;\n}\n\n[data-theme="dark"] {\n    --secondary-background-color: #000;\n    --background-color: #191919;\n    --secondary-notselected-background-color: #101010;\n    --element-backgound-color: #444;\n    --front-color: #dfdfdf;\n    --front-secondary-color: #999;\n    --element-border-color: #555;\n    --link-color: #4baeff;\n}\n\n/**************************************/\n\n* {\n    transition: background-color 0.3s ease-in-out, color 0.1s ease-in-out;\n    user-select: none;\n}\n\n.inputReact {\n    background-color: var(--element-backgound-color);\n    color: var(--front-color);\n    padding: 5px;\n    border: 1px solid var(--element-border-color);\n    border-radius: 5px;\n    font-size: var(--medium-font-size);\n}\n\ninput[type=file] {\n    display: none;\n}\n\ninput[type=number] {\n    width: 50px;\n}\n\nCanvas {\n    border: 1px solid var(--element-border-color);\n}\n\nhr {\n    border: 0;\n    border-top: 1px solid var(--element-border-color);\n}\n\n/**************************************/\n\n.displayFlexColumn {\n    display: flex;\n    flex-direction: column;\n    justify-items: center;\n    align-items: center;\n}\n\n.displayFlexRow {\n    display: flex;\n    flex-direction: row;\n    justify-items: center;\n    align-items: center;\n}\n\n/**************************************/\n\n.marginTopHigh {\n    margin-top: 20px;\n}\n\n.marginTopMedium {\n    margin-top: 10px;\n}\n\n.marginTopLow {\n    margin-top: 5px;\n}\n\n.marginLeftLow {\n    margin-left: 5px;\n}\n\n.marginRightLow {\n    margin-right: 5px;\n}\n\n.marginBottomMedium {\n    margin-bottom: 10px;\n}\n\n.marginBottomHigh {\n    margin-bottom: 20px;\n}\n\n.marginBottomExtreme {\n    margin-bottom: 40px;\n}\n\n/**************************************/\n\n.justifyCenter {\n    justify-content: center;\n}\n\n.justifySpaceBetween {\n    justify-content: space-between;\n}\n\n.gapLow {\n    gap: 5px;\n}\n\n.alignCenter {\n    align-items: center;\n}\n\n.flexColumn {\n    flex-direction: column;\n}\n\n.flexRow {\n    flex-direction: row;\n}\n\n.positionRelative {\n    position: relative;\n}\n\n.textAlignCenter {\n    text-align: center;\n}\n\n/**************************************/\n\n.paddingLow {\n    padding: 5px;\n}\n\n.paddingMedium {\n    padding: 10px;\n}\n\n.paddingHigh {\n    padding: 15px;\n}\n\n.displayNone {\n    display: none;\n}\n\n.displayBlock {\n    display: block;\n}\n\n.displayFlex {\n    display: flex;\n}\n\n.fontLarge {\n    font-size: var(--large-font-size);\n}\n\n.fontMedium {\n    font-size: var(--medium-font-size);\n}\n\n.fontSmall {\n    font-size: var(--small-font-size);\n}\n\n.textDecorationNone {\n    text-decoration: none;\n}\n\n.borderNone {\n    border: none;\n}\n\n.borderRadiusLow {\n    border-radius: 5px;\n}\n\n.borderRadiusHigh {\n    border-radius: 10px;\n}\n\n.borderRadiusExtreme {\n    border-radius: 20px;\n}\n\n.borderRadiusOnlyTop {\n    border-radius: 10px 10px 0 0;\n}\n\n.borderRadiusOnlyBottom {\n    border-radius: 0 0 15px 15px;\n}\n\n.borderSolidNone {\n    border: 0px, solid;\n}\n\n.borderCollapse {\n    border-collapse: collapse;\n}\n\n.frontColor {\n    color: var(--front-color);\n}\n\n.frontSecondaryColor {\n    color: var(--front-secondary-color);\n}\n\n.frontLinkColor {\n    color: var(--link-color);\n}\n\n.backgroundSecondary {\n    background-color: var(--secondary-background-color);\n}\n\n.backgroundNotSelected {\n    background-color: var(--secondary-notselected-background-color);\n}\n\n.backgroundElement {\n    background-color: var(--element-backgound-color);\n}\n\n.backgroundPrimary {\n    background-color: var(--background-color);\n}\n\n/**************************************/\n\n.transformNone {\n    transform: none;\n}\n\n.transformSize:hover {\n    transform: scale(1.05);\n    transition: transform 0.2s;\n}\n\n.transformSecondary:hover {\n    transform: none;\n    background-color: var(--secondary-background-color);\n}\n\n/**************************************/\n\n.refWidthHigh {\n    width: 90%;\n}\n\n.refWidthFull {\n    width: 100%;\n}\n\n.refWidthHalf {\n    width: 50%;\n}',""]);const c=i},618:(e,t,n)=>{n.d(t,{A:()=>c});var r=n(601),a=n.n(r),o=n(314),i=n.n(o)()(a());i.push([e.id,"#isDarkmodeContainer {\n    position: fixed;\n    left: 10px;\n    bottom: 10px;\n    border: 1px solid var(--element-border-color);\n    box-shadow: 0 0 10px 5px rgba(0, 0, 0, 0.1);\n    border-radius: 40px;\n}\n\n.DisplayArea {\n    max-width: 1000px;\n    min-width: 300px;\n}\n\n.title {\n    font-size: clamp(30px, 5vw, 50px);\n    margin-bottom: 10px;\n}\n\n.subTitle {\n    font-size: clamp(20px, 3vw, 30px);\n    margin-top: auto;\n    margin-bottom: 12px;\n}\n\n.RowContainer {\n    width: min(100%, 750px);\n}\n\n#versionRecordTable {\n    max-width: min(100%, 600px);\n}\n\n#versionRecordTable td {\n    padding: 10px;\n}",""]);const c=i},107:(e,t,n)=>{n.d(t,{A:()=>c});var r=n(601),a=n.n(r),o=n(314),i=n.n(o)()(a());i.push([e.id,'.switchContainer {\n    display: flex;\n    align-items: center;\n    cursor: pointer;\n}\n\n.switch {\n    position: relative;\n    display: inline-block;\n    width: 40px;\n    height: 22px;\n}\n\n.switch input {\n    opacity: 0;\n    width: 0;\n    height: 0;\n}\n\n.switchSlider {\n    position: absolute;\n    cursor: pointer;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background-color: #ccc;\n    transition: .4s;\n    border-radius: 22px;\n}\n\n.switchSlider:before {\n    position: absolute;\n    content: "";\n    height: 18px;\n    width: 18px;\n    left: 2px;\n    bottom: 2px;\n    background-color: white;\n    transition: .4s;\n    border-radius: 50%;\n}\n\ninput:checked+.switchSlider {\n    background-color: #002a6e;\n}\n\ninput:checked+.switchSlider:before {\n    transform: translateX(100%);\n}',""]);const c=i},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,a,o){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(r)for(var c=0;c<this.length;c++){var u=this[c][0];null!=u&&(i[u]=!0)}for(var l=0;l<e.length;l++){var s=[].concat(e[l]);r&&i[s[0]]||(void 0!==o&&(void 0===s[5]||(s[1]="@layer".concat(s[5].length>0?" ".concat(s[5]):""," {").concat(s[1],"}")),s[5]=o),n&&(s[2]?(s[1]="@media ".concat(s[2]," {").concat(s[1],"}"),s[2]=n):s[2]=n),a&&(s[4]?(s[1]="@supports (".concat(s[4],") {").concat(s[1],"}"),s[4]=a):s[4]="".concat(a)),t.push(s))}},t}},601:e=>{e.exports=function(e){return e[1]}},72:e=>{var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var o={},i=[],c=0;c<e.length;c++){var u=e[c],l=r.base?u[0]+r.base:u[0],s=o[l]||0,d="".concat(l," ").concat(s);o[l]=s+1;var h=n(d),f={css:u[1],media:u[2],sourceMap:u[3],supports:u[4],layer:u[5]};if(-1!==h)t[h].references++,t[h].updater(f);else{var p=a(f,r);r.byIndex=c,t.splice(c,0,{identifier:d,updater:p,references:1})}i.push(d)}return i}function a(e,t){var n=t.domAPI(t);n.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,a){var o=r(e=e||[],a=a||{});return function(e){e=e||[];for(var i=0;i<o.length;i++){var c=n(o[i]);t[c].references--}for(var u=r(e,a),l=0;l<o.length;l++){var s=n(o[l]);0===t[s].references&&(t[s].updater(),t.splice(s,1))}o=u}}},659:e=>{var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var a=void 0!==n.layer;a&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,a&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var o=n.sourceMap;o&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={id:r,exports:{}};return e[r](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0;var r=n(72),a=n.n(r),o=n(825),i=n.n(o),c=n(659),u=n.n(c),l=n(56),s=n.n(l),d=n(540),h=n.n(d),f=n(113),p=n.n(f),v=n(107),g={};g.styleTagTransform=p(),g.setAttributes=s(),g.insert=u().bind(null,"head"),g.domAPI=i(),g.insertStyleElement=h();a()(v.A,g);v.A&&v.A.locals&&v.A.locals;var m=n(431),y={};y.styleTagTransform=p(),y.setAttributes=s(),y.insert=u().bind(null,"head"),y.domAPI=i(),y.insertStyleElement=h();a()(m.A,y);m.A&&m.A.locals&&m.A.locals;var _=n(618),b={};b.styleTagTransform=p(),b.setAttributes=s(),b.insert=u().bind(null,"head"),b.domAPI=i(),b.insertStyleElement=h();a()(_.A,b);_.A&&_.A.locals&&_.A.locals;var w={},x={};const I=JSON.parse('{"app_version":"1.0.0","is_colored":true,"scale_i":0.3,"scale_c":0.2,"weight_i":0.7,"max_size":1200}');function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function k(){k=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function s(e,t,n,r){var o=t&&t.prototype instanceof m?t:m,i=Object.create(o.prototype),c=new M(r||[]);return a(i,"_invoke",{value:L(e,n,c)}),i}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var h="suspendedStart",f="suspendedYield",p="executing",v="completed",g={};function m(){}function y(){}function _(){}var b={};l(b,i,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(A([])));x&&x!==n&&r.call(x,i)&&(b=x);var I=_.prototype=m.prototype=Object.create(b);function E(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function D(e,t){function n(a,o,i,c){var u=d(e[a],e,o);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==C(s)&&r.call(s,"__await")?t.resolve(s.__await).then((function(e){n("next",e,i,c)}),(function(e){n("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return n("throw",e,i,c)}))}c(u.arg)}var o;a(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,a){n(e,r,t,a)}))}return o=o?o.then(a,a):a()}})}function L(t,n,r){var a=h;return function(o,i){if(a===p)throw Error("Generator is already running");if(a===v){if("throw"===o)throw i;return{value:e,done:!0}}for(r.method=o,r.arg=i;;){var c=r.delegate;if(c){var u=S(c,r);if(u){if(u===g)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===h)throw a=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=p;var l=d(t,n,r);if("normal"===l.type){if(a=r.done?v:f,l.arg===g)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(a=v,r.method="throw",r.arg=l.arg)}}}function S(t,n){var r=n.method,a=t.iterator[r];if(a===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,S(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var o=d(a,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var i=o.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function A(t){if(t||""===t){var n=t[i];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function n(){for(;++a<t.length;)if(r.call(t,a))return n.value=t[a],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(C(t)+" is not iterable")}return y.prototype=_,a(I,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:y,configurable:!0}),y.displayName=l(_,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,u,"GeneratorFunction")),e.prototype=Object.create(I),e},t.awrap=function(e){return{__await:e}},E(D.prototype),l(D.prototype,c,(function(){return this})),t.AsyncIterator=D,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var i=new D(s(e,n,r,a),o);return t.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},E(I),l(I,u,"Generator"),l(I,i,(function(){return this})),l(I,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=A,M.prototype={constructor:M,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function a(r,a){return c.type="throw",c.arg=t,n.next=r,a&&(n.method="next",n.arg=e),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var u=r.call(i,"catchLoc"),l=r.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;O(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:A(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function E(e,t,n,r,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,a)}function D(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,T(r.key),r)}}function L(e,t,n){return t&&D(e.prototype,t),n&&D(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function S(e,t,n){return(t=T(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e){var t=function(e,t){if("object"!=C(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=C(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==C(t)?t:t+""}document.addEventListener("DOMContentLoaded",(function(){var e=[{id:"maxSizeInput",value:I.max_size},{id:"innerScaleRange",value:I.scale_i},{id:"innerScaleInput",value:I.scale_i},{id:"coverScaleRange",value:I.scale_c},{id:"coverScaleInput",value:I.scale_c},{id:"innerWeightRange",value:I.weight_i},{id:"innerWeightInput",value:I.weight_i}];document.getElementById("isColoredCheckbox").checked=I.is_colored,e.forEach((function(e){document.getElementById(e.id).value=e.value}))}));var O=L((function e(t,n,r,a,o,i){var c=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),S(this,"updateInnerImg",function(){var e,t=(e=k().mark((function e(t){var n;return k().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c._innerDataCache=null,c._innerImg=t,0!==c._max_size?c._innerImg.width>c._innerImg.height?(c._width=c._max_size,c._height=Math.ceil(c._innerImg.height*c._max_size/c._innerImg.width)):(c._height=c._max_size,c._width=Math.ceil(c._innerImg.width*c._max_size/c._innerImg.height)):(c._width=c._innerImg.width,c._height=c._innerImg.height),c._innerCanvas.width=c._width,c._innerCanvas.height=c._height,(n=c._innerCanvas.getContext("2d")).drawImage(t,0,0,c._width,c._height),c._innerImgData=n.getImageData(0,0,c._width,c._height),c._is_colored||c._convertGray(c._innerImgData),c._coverImgData&&c.updateCoverImg(c._coverImg);case 10:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){E(o,r,a,i,c,"next",e)}function c(e){E(o,r,a,i,c,"throw",e)}i(void 0)}))});return function(e){return t.apply(this,arguments)}}()),S(this,"updateCoverImg",(function(e){if(c._coverDataCache=null,c._coverImg=e,c._innerImg){var t,n,r,a,o=e.width/e.height;o<c._width/c._height?(t=0,n=Math.ceil((c._height-c._width/o)/2),r=c._width,a=Math.ceil(c._width/o)):(t=Math.ceil((c._width-c._height*o)/2),n=0,r=Math.ceil(c._height*o),a=c._height),c._coverCanvas.width=c._width,c._coverCanvas.height=c._height;var i=c._coverCanvas.getContext("2d");i.drawImage(e,t,n,r,a),c._coverImgData=i.getImageData(0,0,c._width,c._height)}else{c._coverCanvas.width=e.width,c._coverCanvas.height=e.height;var u=c._coverCanvas.getContext("2d");u.drawImage(e,0,0),c._coverImgData=u.getImageData(0,0,e.width,e.height)}c._is_colored||c._convertGray(c._coverImgData),c._innerImgData&&c._process()})),S(this,"swapImg",(function(){if(c._innerImg||c._coverImg){if(!c._innerImg)return c._clearCanvas(c._coverCanvas),c._coverImgData=null,c.updateInnerImg(c._coverImg),void(c._coverImg=null);if(!c._coverImg)return c._clearCanvas(c._innerCanvas),c._innerImgData=null,c.updateCoverImg(c._innerImg),void(c._innerImg=null);var e=c._innerImg;c._innerImg=c._coverImg,c._coverImg=e;var t=c._innerImgData;c._innerImgData=c._coverImgData,c._coverImgData=t,c._innerCanvas.getContext("2d").putImageData(c._innerImgData,0,0),c._coverCanvas.getContext("2d").putImageData(c._coverImgData,0,0),c._innerDataCache=null,c._coverDataCache=null,c._process()}})),S(this,"_clearCanvas",(function(e){e.width=e.width})),S(this,"_convertGray",(function(e){for(var t=e.data,n=0;n<t.length;n+=4){var r=Math.floor(.299*t[n]+.587*t[n+1]+.114*t[n+2]);t[n]=r,t[n+1]=r,t[n+2]=r}})),S(this,"updateColorMode",(function(e){c._is_colored=e,c._innerImgData&&c.updateInnerImg(c._innerImg)})),S(this,"updateMaxSize",(function(e){c._max_size=e,c._innerImg&&c.updateInnerImg(c._innerImg)})),S(this,"updateInnerScale",(function(e){c._scale_i=e,c._innerDataCache=null,c._process()})),S(this,"updateCoverScale",(function(e){c._scale_c=1-e,c._coverDataCache=null,c._process()})),S(this,"updateInnerWeight",(function(e){c._weight_i=e,c._process()})),S(this,"_process",(function(){if(c._innerImgData&&c._coverImgData){var e=!1;if(!c._innerDataCache){var t=c._innerImgData.data;c._innerDataCache=new Uint8ClampedArray(t.length);for(var n=0;n<t.length;n+=4)c._innerDataCache[n]=Math.floor(t[n]*c._scale_i),c._innerDataCache[n+1]=Math.floor(t[n+1]*c._scale_i),c._innerDataCache[n+2]=Math.floor(t[n+2]*c._scale_i);e=!0}if(!c._coverDataCache){var r=c._coverImgData.data;c._coverDataCache=new Uint8ClampedArray(r.length);for(var a=0;a<r.length;a+=4)c._coverDataCache[a]=Math.floor(255-(255-r[a])*c._scale_c),c._coverDataCache[a+1]=Math.floor(255-(255-r[a+1])*c._scale_c),c._coverDataCache[a+2]=Math.floor(255-(255-r[a+2])*c._scale_c);e=!0}if(c._is_colored){if(!c._alphaCache||e){c._alphaCache=new Float32Array(c._innerDataCache.length>>2);for(var o=0;o<c._innerDataCache.length;o+=4){var i=c._innerDataCache[o],u=c._innerDataCache[o+1],l=c._innerDataCache[o+2],s=c._coverDataCache[o],d=i-s,h=u-c._coverDataCache[o+1],f=l-c._coverDataCache[o+2];c._alphaCache[o>>2]=Math.min(Math.max(1+((2048|d+(i+s<<1))*d-(f+(i+s<<1)-3068)*f+(h<<12))/(1020*(d-f)+2349060),0),1)}}c._outputData=new Uint8ClampedArray(c._innerDataCache.length);for(var p=0;p<c._innerDataCache.length;p+=4){var v=c._alphaCache[p>>2],g=255*v;c._outputData[p]=((c._innerDataCache[p]-g+255-c._coverDataCache[p])*c._weight_i+g-255+c._coverDataCache[p])/v,c._outputData[p+1]=((c._innerDataCache[p+1]-g+255-c._coverDataCache[p+1])*c._weight_i+g-255+c._coverDataCache[p+1])/v,c._outputData[p+2]=((c._innerDataCache[p+2]-g+255-c._coverDataCache[p+2])*c._weight_i+g-255+c._coverDataCache[p+2])/v,c._outputData[p+3]=255*v}}else{c._outputData=new Uint8ClampedArray(c._innerDataCache.length);for(var m=0;m<c._innerDataCache.length;m+=4){var y=255+c._innerDataCache[m]-c._coverDataCache[m],_=255*c._innerDataCache[m]/y;c._outputData[m]=_,c._outputData[m+1]=_,c._outputData[m+2]=_,c._outputData[m+3]=y}}c._showOutput()}})),S(this,"_showOutput",(function(){c._outputCanvas.width=c._width,c._outputCanvas.height=c._height,c._outputCanvas.getContext("2d").putImageData(new ImageData(c._outputData,c._width,c._height),0,0),c._blackCanvas.width=c._width,c._blackCanvas.height=c._height;var e=c._blackCanvas.getContext("2d");e.fillStyle="black",e.fillRect(0,0,c._width,c._height),e.drawImage(c._outputCanvas,0,0),c._whiteCanvas.width=c._width,c._whiteCanvas.height=c._height;var t=c._whiteCanvas.getContext("2d");t.fillStyle="white",t.fillRect(0,0,c._width,c._height),t.drawImage(c._outputCanvas,0,0)})),S(this,"saveResult",(function(){var e=document.createElement("a");e.download="result_".concat((new Date).getTime(),".png"),e.href=c._outputCanvas.toDataURL("image/png"),document.body.appendChild(e),e.click(),document.body.removeChild(e)})),this._scale_i=t.scale_i,this._scale_c=1-t.scale_c,this._weight_i=t.weight_i,this._innerCanvas=n,this._coverCanvas=r,this._outputCanvas=a,this._whiteCanvas=o,this._blackCanvas=i,this._is_colored=t.is_colored,this._max_size=t.max_size}));function M(e){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(e)}function A(){A=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function s(e,t,n,r){var o=t&&t.prototype instanceof m?t:m,i=Object.create(o.prototype),c=new T(r||[]);return a(i,"_invoke",{value:E(e,n,c)}),i}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=s;var h="suspendedStart",f="suspendedYield",p="executing",v="completed",g={};function m(){}function y(){}function _(){}var b={};l(b,i,(function(){return this}));var w=Object.getPrototypeOf,x=w&&w(w(O([])));x&&x!==n&&r.call(x,i)&&(b=x);var I=_.prototype=m.prototype=Object.create(b);function C(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function n(a,o,i,c){var u=d(e[a],e,o);if("throw"!==u.type){var l=u.arg,s=l.value;return s&&"object"==M(s)&&r.call(s,"__await")?t.resolve(s.__await).then((function(e){n("next",e,i,c)}),(function(e){n("throw",e,i,c)})):t.resolve(s).then((function(e){l.value=e,i(l)}),(function(e){return n("throw",e,i,c)}))}c(u.arg)}var o;a(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,a){n(e,r,t,a)}))}return o=o?o.then(a,a):a()}})}function E(t,n,r){var a=h;return function(o,i){if(a===p)throw Error("Generator is already running");if(a===v){if("throw"===o)throw i;return{value:e,done:!0}}for(r.method=o,r.arg=i;;){var c=r.delegate;if(c){var u=D(c,r);if(u){if(u===g)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===h)throw a=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=p;var l=d(t,n,r);if("normal"===l.type){if(a=r.done?v:f,l.arg===g)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(a=v,r.method="throw",r.arg=l.arg)}}}function D(t,n){var r=n.method,a=t.iterator[r];if(a===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,D(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var o=d(a,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var i=o.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function O(t){if(t||""===t){var n=t[i];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,o=function n(){for(;++a<t.length;)if(r.call(t,a))return n.value=t[a],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(M(t)+" is not iterable")}return y.prototype=_,a(I,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:y,configurable:!0}),y.displayName=l(_,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,l(e,u,"GeneratorFunction")),e.prototype=Object.create(I),e},t.awrap=function(e){return{__await:e}},C(k.prototype),l(k.prototype,c,(function(){return this})),t.AsyncIterator=k,t.async=function(e,n,r,a,o){void 0===o&&(o=Promise);var i=new k(s(e,n,r,a),o);return t.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},C(I),l(I,u,"Generator"),l(I,i,(function(){return this})),l(I,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=O,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(S),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function a(r,a){return c.type="throw",c.arg=t,n.next=r,a&&(n.method="next",n.arg=e),!!a}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return a("end");if(i.tryLoc<=this.prev){var u=r.call(i,"catchLoc"),l=r.call(i,"finallyLoc");if(u&&l){if(this.prev<i.catchLoc)return a(i.catchLoc,!0);if(this.prev<i.finallyLoc)return a(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return a(i.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return a(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&r.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var o=a;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;S(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:O(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function j(e,t,n,r,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,a)}function B(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){j(o,r,a,i,c,"next",e)}function c(e){j(o,r,a,i,c,"throw",e)}i(void 0)}))}}var N,P,R=function(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(){var e=new Image;e.src=r.result,e.onload=function(){t(e)},e.onerror=function(e){n(e)}},r.onerror=function(e){n(e)},r.readAsDataURL(e)}))},F=function(){var e=B(A().mark((function e(t,n){var r,a=arguments;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:"操作失败! ",e.prev=1,e.next=4,n(t);case 4:e.next=10;break;case 6:e.prev=6,e.t0=e.catch(1),alert(r+e.t0.message),console.error(r,e.t0.message,e.t0.stack);case 10:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,n){return e.apply(this,arguments)}}(),z=document.getElementById("innerScaleRange"),G=document.getElementById("innerScaleInput"),W=document.getElementById("coverScaleRange"),H=document.getElementById("coverScaleInput"),U=document.getElementById("innerWeightRange"),X=document.getElementById("innerWeightInput"),Y=[{id:"innerFileInput",event:"change",callback:(P=B(A().mark((function e(t){var n;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target.files[0],e.t0=x.mirage,e.next=4,R(n);case 4:e.t1=e.sent,e.t0.updateInnerImg.call(e.t0,e.t1),t.target.value="";case 7:case"end":return e.stop()}}),e)}))),function(e){return P.apply(this,arguments)}),errorMsg:"里图加载失败! "},{id:"coverFileInput",event:"change",callback:(N=B(A().mark((function e(t){var n;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target.files[0],e.t0=x.mirage,e.next=4,R(n);case 4:e.t1=e.sent,e.t0.updateCoverImg.call(e.t0,e.t1),t.target.value="";case 7:case"end":return e.stop()}}),e)}))),function(e){return N.apply(this,arguments)}),errorMsg:"表图加载失败! "},{id:"innerCanvas",event:"click",callback:function(){document.getElementById("innerFileInput").click()},errorMsg:"里图加载失败! "},{id:"coverCanvas",event:"click",callback:function(){document.getElementById("coverFileInput").click()},errorMsg:"表图加载失败! "},{id:"innerScaleRange",event:"input",callback:function(e){G.value=e.target.value,x.mirage.updateInnerScale(parseFloat(e.target.value))}},{id:"innerScaleInput",event:"input",callback:function(e){clearTimeout(w.innerScaleTimeout),w.innerScaleTimeout=setTimeout((function(){var t=parseFloat(e.target.value);isNaN(t)||(t=Math.min(Math.max(t,0),1),z.value=t,G.value=t,x.mirage.updateInnerScale(t))}),500)}},{id:"coverScaleRange",event:"input",callback:function(e){H.value=e.target.value,x.mirage.updateCoverScale(parseFloat(e.target.value))}},{id:"coverScaleInput",event:"input",callback:function(e){clearTimeout(w.coverScaleTimeout),w.coverScaleTimeout=setTimeout((function(){var t=parseFloat(e.target.value);isNaN(t)||(t=Math.min(Math.max(t,0),1),W.value=t,H.value=t,x.mirage.updateCoverScale(t))}),500)}},{id:"innerWeightRange",event:"input",callback:function(e){X.value=e.target.value,x.mirage.updateInnerWeight(parseFloat(e.target.value))}},{id:"innerWeightInput",event:"input",callback:function(e){clearTimeout(w.innerWeightTimeout),w.innerWeightTimeout=setTimeout((function(){var t=parseFloat(e.target.value);isNaN(t)||(t=Math.min(Math.max(t,0),1),U.value=t,X.value=t,x.mirage.updateInnerWeight(t))}),500)}},{id:"isColoredCheckbox",event:"change",callback:function(e){x.mirage.updateColorMode(e.target.checked)}},{id:"maxSizeInput",event:"input",callback:function(e){clearTimeout(w.maxSizeTimeout),w.maxSizeTimeout=setTimeout((function(){var t=parseInt(e.target.value);t=Math.min(Math.max(t,0),4096),e.target.value=t,x.mirage.updateMaxSize(t)}),500)}},{id:"saveButton",event:"click",callback:function(){x.mirage.saveResult()},errorMsg:"保存失败! "},{id:"swapButton",event:"click",callback:function(){x.mirage.swapImg()}}];function q(e,t,n){if(V())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var a=new(e.bind.apply(e,r));return n&&J(a,n.prototype),a}function J(e,t){return J=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},J(e,t)}function V(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(V=function(){return!!e})()}var K=navigator.userAgent;w.isOnPhone=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(K),w.isDownloadNotSupported=w.isOnPhone&&/xiaomi|miui|quark|ucbrowser/i.test(K),w.isOnTiebaBrowser=/tieba/i.test(K);var Q=function(e){void 0!==e&&"string"==typeof e||(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");document.documentElement.setAttribute("data-theme",e),document.getElementById("isDarkmodeCheckbox").checked="dark"===e};document.addEventListener("DOMContentLoaded",(function(){Q(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",Q),document.getElementById("isDarkmodeCheckbox").addEventListener("change",(function(e){var t=e.target.checked?"dark":"light";Q(t)})),w.isOnTiebaBrowser&&alert("建议点击右上角使用正常浏览器打开本页面。"),w.isDownloadNotSupported&&alert("由于浏览器限制，图片保存功能可能出现异常，建议使用其他浏览器或等待后续更新适配。"),w.defaultArguments=I,w.version=w.defaultArguments.app_version,console.log("target version:",w.version),console.log("local version:",localStorage.getItem("version"));var e=localStorage.getItem("version");e&&e===w.version||(console.log("new version detected, clearing cache"),localStorage.clear(),localStorage.setItem("version",w.version),location.reload(!0));var t=document.getElementById("versionInfo");t&&(t.innerHTML="version: <b>".concat(w.version,"</b>"));var n=[document.getElementById("innerCanvas"),document.getElementById("coverCanvas"),document.getElementById("outputCanvas"),document.getElementById("whiteCanvas"),document.getElementById("blackCanvas")];x.mirage=q(O,[w.defaultArguments].concat(n)),function(){try{Y.forEach((function(e){document.getElementById(e.id).addEventListener(e.event,(function(t){F(t,e.callback,e.errorMsg||"操作失败! ")}))})),w.isOnPhone?(document.getElementById("innerInputHint").remove(),document.getElementById("coverInputHint").remove()):(w.mouseX=0,window.addEventListener("mousemove",(function(e){w.mouseX=e.clientX})),window.addEventListener("dragover",(function(e){e.preventDefault()})),document.addEventListener("paste",(function(e){F(e,function(){var e=B(A().mark((function e(t){var n,r,a;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.clipboardData.items,r=0;case 2:if(!(r<n.length)){e.next=22;break}if(-1===n[r].type.indexOf("image")){e.next=19;break}if(a=n[r].getAsFile(),!(w.mouseX>window.innerWidth/2)){e.next=13;break}return e.t0=x.mirage,e.next=9,R(a);case 9:e.t1=e.sent,e.t0.updateCoverImg.call(e.t0,e.t1),e.next=18;break;case 13:return e.t2=x.mirage,e.next=16,R(a);case 16:e.t3=e.sent,e.t2.updateInnerImg.call(e.t2,e.t3);case 18:return e.abrupt("break",22);case 19:r++,e.next=2;break;case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),"加载失败! ")})),document.getElementById("innerCanvas").addEventListener("drop",(function(e){e.preventDefault(),F(e,function(){var e=B(A().mark((function e(t){var n,r,a;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.dataTransfer.items,r=0;case 2:if(!(r<n.length)){e.next=14;break}if("file"!==n[r].kind||-1===n[r].type.indexOf("image")){e.next=11;break}return a=n[r].getAsFile(),e.t0=x.mirage,e.next=8,R(a);case 8:return e.t1=e.sent,e.t0.updateInnerImg.call(e.t0,e.t1),e.abrupt("break",14);case 11:r++,e.next=2;break;case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})),document.getElementById("coverCanvas").addEventListener("drop",(function(e){e.preventDefault(),F(e,function(){var e=B(A().mark((function e(t){var n,r,a;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.dataTransfer.items,r=0;case 2:if(!(r<n.length)){e.next=14;break}if("file"!==n[r].kind||-1===n[r].type.indexOf("image")){e.next=11;break}return a=n[r].getAsFile(),e.t0=x.mirage,e.next=8,R(a);case 8:return e.t1=e.sent,e.t0.updateCoverImg.call(e.t0,e.t1),e.abrupt("break",14);case 11:r++,e.next=2;break;case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}))),document.getElementById("toggleVersionRecord").addEventListener("click",(function(e){var t=document.getElementById("versionRecordTable");"none"===window.getComputedStyle(t).display?(t.classList.remove("displayNone"),t.classList.add("displayBlock"),e.target.textContent="隐藏主要更新记录",window.scrollTo(0,document.body.scrollHeight)):(t.classList.remove("displayBlock"),t.classList.add("displayNone"),e.target.textContent="显示主要更新记录")}))}catch(e){alert("监听器设置失败! "+e.message),console.error("监听器设置失败!",e.message,e.stack)}}()}))})();</script></body></html>